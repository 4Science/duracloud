<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-4.0.xsd">

  <!-- REST API resources -->
  <bean id="initRest" class="org.duracloud.durastore.rest.InitRest" >
    <constructor-arg ref="storageProviderFactory"/>
    <constructor-arg ref="restUtil"/>
    <constructor-arg ref="millRepoDataSource"/>

  </bean>

  <bean id="storeRest" class="org.duracloud.durastore.rest.StoreRest" >
    <constructor-arg ref="storageProviderFactory"/>
    <constructor-arg ref="storageAccountsDocumentBinding"/>
  </bean>

  <bean id="taskRest" class="org.duracloud.durastore.rest.TaskRest" >
    <constructor-arg ref="taskProviderFactory"/>
    <constructor-arg ref="restUtil"/>
  </bean>

  <bean id="spaceRest" class="org.duracloud.durastore.rest.SpaceRest" >
    <constructor-arg ref="spaceResource"/>
    <constructor-arg ref="securityContextUtil"/>
  </bean>  

  <bean id="contentRest" class="org.duracloud.durastore.rest.ContentRest" >
    <constructor-arg ref="contentResource"/>
    <constructor-arg ref="restUtil"/>
  </bean>

  <bean id="securityRest" class="org.duracloud.durastore.rest.SecurityRest">
    <constructor-arg ref="userDetailsSvc" />
    <constructor-arg ref="restUtil"/>
  </bean>

  <!--manifest-->
  <bean id="manifestResource" class="org.duracloud.durastore.rest.ManifestResource">
    <constructor-arg ref="manifestGenerator"/>
  </bean>

  <bean id="manifestRest" class="org.duracloud.durastore.rest.ManifestRest" >
    <constructor-arg ref="manifestResource"/>
    <constructor-arg ref="storageProviderFactory"/>
  </bean>

  <bean id="manifestGenerator" class="org.duracloud.manifest.impl.ManifestGeneratorImpl">
    <constructor-arg ref="manifestStore"/>
  </bean>

  <bean id="auditLogRest" class="org.duracloud.durastore.rest.AuditLogRest" >
    <constructor-arg ref="auditLogReader"/>
    <constructor-arg ref="storageProviderFactory"/>
  </bean>

  <bean id="auditLogReader" class="org.duracloud.audit.reader.impl.AuditLogReaderImpl" >
    <constructor-arg >
        <bean class="org.duracloud.audit.AuditConfig">
            <property name="storeId" value="${duracloud.audit.storeId}"/>
            <property name="spaceId" value="${duracloud.audit.spaceId}"/>
            <property name="duracloudHost" value="${duracloud.audit.host}"/>
            <property name="duracloudPort" value="${duracloud.audit.port}"/>
            <property name="duracloudUsername" value="${duracloud.audit.username}"/>
            <property name="duracloudPassword" value="${duracloud.audit.password}"/>
        </bean>
    </constructor-arg>
  </bean>


  <!-- Support beans -->
  <bean id="storageAccountsDocumentBinding"
        class="org.duracloud.storage.xml.StorageAccountsDocumentBinding" />

  <bean id="securityContextUtil" class="org.duracloud.security.context.SecurityContextUtil"/>

  <bean id="spaceResource" class="org.duracloud.durastore.rest.SpaceResource" >
    <constructor-arg ref="storageProviderFactory"/>
  </bean>

  <bean id="contentResource" class="org.duracloud.durastore.rest.ContentResourceImpl" >
    <constructor-arg ref="storageProviderFactory"/>
  </bean>

  <bean id="taskProviderFactory" class="org.duracloud.durastore.util.TaskProviderFactory">
    <constructor-arg ref="storageAcctManager"/>
    <constructor-arg ref="storageProviderFactory"/>
  </bean>
  
  <bean id="storageProviderFactory" class="org.duracloud.durastore.util.StorageProviderFactoryImpl">
    <constructor-arg ref="statelessStoragePvdr" />
    <constructor-arg ref="storageAcctManager" />
    <constructor-arg ref="securityContextUtil"/>
    <constructor-arg value="true" />
  </bean>

  <bean id="statelessStoragePvdr" class="org.duracloud.storage.provider.StatelessStorageProviderImpl"/>

  <bean id="storageAcctManager" class="org.duracloud.storage.domain.StorageAccountManager"/>

  <bean id="restUtil" class="org.duracloud.common.rest.RestUtilImpl"/>

</beans>
