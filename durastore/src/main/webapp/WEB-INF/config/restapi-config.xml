<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:aop="http://www.springframework.org/schema/aop"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
           http://www.springframework.org/schema/aop
           http://www.springframework.org/schema/aop/spring-aop-4.0.xsd  
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-4.0.xsd">

  <bean  depends-on="systemPropertiesReader" class="org.duracloud.common.db.DataSourceConfigurer">
    <constructor-arg ref="accountRepoDataSource"/>
    <constructor-arg value="${db.name}"/>
    <constructor-arg value="${db.host}"/>
    <constructor-arg value="${db.port}"/>
    <constructor-arg value="${db.user}"/>
    <constructor-arg value="${db.pass}"/>
  </bean>

  <bean  depends-on="systemPropertiesReader" class="org.duracloud.common.db.DataSourceConfigurer">
    <constructor-arg ref="millRepoDataSource"/>
    <constructor-arg value="${mill.db.name}"/>
    <constructor-arg value="${mill.host}"/>
    <constructor-arg value="${mill.port}"/>
    <constructor-arg value="${mill.user}"/>
    <constructor-arg value="${mill.pass}"/>
  </bean>
 
  <!--manifest-->
  <bean id="manifestResource" class="org.duracloud.durastore.rest.ManifestResource">
    <constructor-arg ref="manifestGenerator"/>
  </bean>

  <bean id="manifestGenerator" class="org.duracloud.manifest.impl.ManifestGeneratorImpl">
    <constructor-arg ref="manifestStore"/>
    <constructor-arg ref="storageProviderFactory"/>

  </bean>


  <bean id="auditLogReader" class="org.duracloud.audit.reader.impl.AuditLogReaderImpl" >
  </bean>


  <!-- Support beans -->
  <bean id="storageAccountsDocumentBinding"
        class="org.duracloud.storage.xml.StorageAccountsDocumentBinding" />

  <bean id="securityContextUtil" class="org.duracloud.security.context.SecurityContextUtil"/>

  <bean id="spaceResource" class="org.duracloud.durastore.rest.SpaceResource" >
    <constructor-arg ref="storageProviderFactory"/>
  </bean>

  <bean id="contentResource" class="org.duracloud.durastore.rest.ContentResourceImpl" >
    <constructor-arg ref="storageProviderFactory"/>
  </bean>

  <bean id="taskProviderFactoryImpl" class="org.duracloud.durastore.util.TaskProviderFactoryImpl">
    <constructor-arg ref="storageAcctManager"/>
    <constructor-arg ref="storageProviderFactory"/>
    <constructor-arg ref="manifestStore"/>
  </bean>
  
  <bean id="localStorageProviderFactory" class="org.duracloud.durastore.util.StorageProviderFactoryImpl">
    <constructor-arg ref="statelessStoragePvdr" />
    <constructor-arg ref="storageAcctManager" />
    <constructor-arg ref="securityContextUtil"/>
    <constructor-arg value="true" />
  </bean>
  
  <bean id="contextUtil" class="org.duracloud.common.rest.DuraCloudRequestContextUtil"/>

  <bean id="globalStorageProviderStore" class="org.duracloud.durastore.util.GlobalStorageProviderStore">
    <constructor-arg ref="accountRepo" />
    <constructor-arg ref="contextUtil"/>
    <constructor-arg ref="statelessStoragePvdr" />
    <constructor-arg ref="securityContextUtil"/>
  </bean>
  
  <bean id="userFinderUtil" class="org.duracloud.account.db.repo.UserFinderUtil">
    <constructor-arg ref="repoMgr"/>
  </bean>
  
  <bean id="storageProviderFactory"  class="org.duracloud.durastore.rest.StorageProviderFactoryBean" lazy-init="true" scope="request">
    <property name="globalStorageProviderStore" ref="globalStorageProviderStore" />
    <property name="localStorageProviderFactory" ref="localStorageProviderFactory" />
    <aop:scoped-proxy />
  </bean>

  <bean id="authorizationHelper" class="org.duracloud.security.util.AuthorizationHelper" > 
    <constructor-arg ref="storageProviderFactory"/>
  </bean>

  <bean id="statelessStoragePvdr" class="org.duracloud.storage.provider.StatelessStorageProviderImpl"/>

  <bean id="storageAcctManager" class="org.duracloud.storage.domain.StorageAccountManager"/>

  <bean id="restUtil" class="org.duracloud.common.rest.RestUtilImpl"/>

</beans>
